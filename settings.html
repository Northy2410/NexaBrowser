<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Settings - NexaBrowser</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --bg: #f5f5f5;
      --surface: #ffffff;
      --border: #e0e0e0;
      --text: #202124;
      --muted: #5f6368;
      --muted-2: #80868b;
      --panel: #f8f9fa;
      --primary: #1a73e8;
      --primary-hover: #1765cc;
      --tab-active: #e8f0fe;
      --btn-gradient-start: #667eea;
      --btn-gradient-end: #764ba2;
      --btn-shadow: rgba(102, 126, 234, 0.4);
    }

    [data-theme="dark"] {
      --bg: #0b0f14;
      --surface: #0f141a;
      --border: #1f2937;
      --text: #e5e7eb;
      --muted: #9ca3af;
      --muted-2: #a3a3a3;
      --panel: #111827;
      --primary: #60a5fa;
      --primary-hover: #3b82f6;
      --tab-active: #1e3a5f;
      --btn-gradient-start: #334155;
      --btn-gradient-end: #0f172a;
      --btn-shadow: rgba(2, 6, 23, 0.4);
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: var(--bg);
      color: var(--text);
      overflow: hidden;
      transition: background-color 0.2s ease, color 0.2s ease;
    }

    .settings-container {
      display: flex;
      height: 100vh;
      flex-direction: column;
    }

    .main-content-wrapper {
      display: flex;
      flex: 1;
      overflow: hidden;
    }

    .sidebar {
      width: 200px;
      background: var(--surface);
      border-right: 1px solid var(--border);
      padding: 20px 0;
    }

    .sidebar-item {
      padding: 12px 20px;
      cursor: pointer;
      transition: background-color 0.2s;
      color: var(--text);
      font-size: 14px;
      border-left: 3px solid transparent;
    }

    .sidebar-item:hover {
      background: var(--panel);
    }

    .sidebar-item.active {
      background: var(--tab-active);
      border-left-color: var(--primary);
      font-weight: 500;
    }

    .content {
      flex: 1;
      padding: 30px;
      overflow-y: auto;
      background: var(--bg);
    }

    .actions-bar {
      display: flex;
      gap: 12px;
      justify-content: flex-end;
      align-items: center;
      background: var(--surface);
      padding: 12px 20px;
      border-bottom: 1px solid var(--border);
      z-index: 10;
    }

    .content-section {
      display: none;
    }

    .content-section.active {
      display: block;
    }

    h1 {
      font-size: 28px;
      margin-bottom: 8px;
      color: var(--text);
    }

    .subtitle {
      color: var(--muted);
      font-size: 14px;
      margin-bottom: 30px;
    }

    .setting-group {
      background: var(--surface);
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
      border: 1px solid var(--border);
    }

    .setting-label {
      font-size: 14px;
      font-weight: 500;
      margin-bottom: 8px;
      display: block;
      color: var(--text);
    }

    .setting-description {
      font-size: 13px;
      color: var(--muted);
      margin-bottom: 12px;
    }

    select, input[type="text"] {
      width: 100%;
      max-width: 300px;
      padding: 8px 12px;
      border: 1px solid var(--border);
      border-radius: 4px;
      background: var(--bg);
      color: var(--text);
      font-size: 14px;
      font-family: inherit;
    }

    select:focus, input[type="text"]:focus {
      outline: none;
      border-color: var(--primary);
    }

    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.2s;
    }

    .btn-primary {
      background: var(--primary);
      color: white;
    }

    .btn-primary:hover {
      background: var(--primary-hover);
    }

    .btn-secondary {
      background: var(--panel);
      color: var(--text);
      border: 1px solid var(--border);
    }

    .btn-secondary:hover {
      background: var(--border);
    }

    .about-content {
      text-align: center;
    }

    .logo {
      width: 100px;
      height: 100px;
      margin: 0 auto 20px;
      background: linear-gradient(135deg, var(--btn-gradient-start) 0%, var(--btn-gradient-end) 100%);
      border-radius: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 48px;
      font-weight: bold;
      box-shadow: 0 4px 12px var(--btn-shadow);
    }

    .logo-img-container {
      width: 100px;
      height: 100px;
      margin: 0 auto 20px;
      position: relative;
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 4px 12px var(--btn-shadow);
      background: linear-gradient(135deg, var(--btn-gradient-start) 0%, var(--btn-gradient-end) 100%);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .logo-img-container img.logo-img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    .version-info {
      font-size: 18px;
      margin-bottom: 30px;
      color: var(--muted);
    }

    .info-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      max-width: 500px;
      margin: 0 auto 30px;
      text-align: left;
    }

    .info-item {
      background: var(--panel);
      padding: 15px;
      border-radius: 6px;
      border: 1px solid var(--border);
    }

    .info-item-label {
      font-size: 12px;
      color: var(--muted);
      margin-bottom: 4px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .info-item-value {
      font-size: 14px;
      color: var(--text);
      font-weight: 500;
    }

    .copyright {
      margin-top: 30px;
      padding-top: 20px;
      border-top: 1px solid var(--border);
      color: var(--muted);
      font-size: 13px;
    }

    .update-section {
      margin-top: 20px;
      padding: 20px;
      background: var(--panel);
      border-radius: 8px;
      border: 1px solid var(--border);
    }

    .update-status {
      margin-top: 15px;
      padding: 12px;
      border-radius: 6px;
      font-size: 14px;
    }

    .update-status.checking {
      background: rgba(26, 115, 232, 0.1);
      color: var(--primary);
    }

    .update-status.available {
      background: rgba(52, 168, 83, 0.1);
      color: #34a853;
    }

    .update-status.current {
      background: rgba(66, 133, 244, 0.1);
      color: var(--primary);
    }

    .update-status.error {
      background: rgba(234, 67, 53, 0.1);
      color: #ea4335;
    }

    .link {
      color: var(--primary);
      text-decoration: none;
      font-weight: 500;
    }

    .link:hover {
      text-decoration: underline;
    }

    .save-status {
      font-size: 13px;
      color: var(--muted);
      min-height: 18px;
    }

    ::-webkit-scrollbar {
      width: 10px;
    }

    ::-webkit-scrollbar-track {
      background: var(--bg);
    }

    ::-webkit-scrollbar-thumb {
      background: var(--border);
      border-radius: 5px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: var(--muted);
    }
  </style>
</head>
<body>
  <div class="settings-container">
    <div class="actions-bar">
      <span id="save-status" class="save-status"></span>
      <button id="save-settings-btn" class="btn btn-primary">Save Settings</button>
    </div>
    <div class="main-content-wrapper">
      <div class="sidebar">
        <div class="sidebar-item active" data-section="general">General</div>
        <div class="sidebar-item" data-section="appearance">Appearance</div>
        <div class="sidebar-item" data-section="about">About</div>
      </div>

      <div class="content">
        <!-- General Section -->
        <div class="content-section active" id="general">
        <h1>General Settings</h1>
        <p class="subtitle">Configure your browsing preferences</p>

        <div class="setting-group">
          <label class="setting-label">Home Page</label>
          <p class="setting-description">The page that opens when you start NexaBrowser (matches your selected search engine)</p>
          <input type="text" id="homepage-input" value="" readonly>
        </div>

        <div class="setting-group">
          <label class="setting-label">On Startup</label>
          <p class="setting-description">Choose what happens when NexaBrowser starts</p>
          <select id="startup-select">
            <option value="homepage">Open Home Page</option>
            <option value="blank">Open New Tab</option>
          </select>
        </div>
          <div class="setting-group">
            <label class="setting-label">Search Engine</label>
            <p class="setting-description">Choose your default search engine for the address bar</p>
            <select id="search-engine-select">
              <option value="nexasearch">NexaSearch (Default)</option>
              <option value="google">Google</option>
              <option value="bing">Bing</option>
              <option value="yahoo">Yahoo</option>
              <option value="duckduckgo">DuckDuckGo</option>
            </select>
          </div>
      </div>

      <!-- Appearance Section -->
      <div class="content-section" id="appearance">
        <h1>Appearance</h1>
        <p class="subtitle">Customize how NexaBrowser looks</p>

        <div class="setting-group">
          <label class="setting-label">Theme</label>
          <p class="setting-description">Choose between light and dark mode</p>
          <select id="theme-select">
            <option value="light">Light</option>
            <option value="dark">Dark</option>
            <option value="system">System Default</option>
          </select>
        </div>

        <div class="setting-group">
          <label class="setting-label">Preview</label>
          <p class="setting-description">Changes apply immediately to all browser windows</p>
        </div>
      </div>

      <!-- About Section -->
      <div class="content-section" id="about">
          <div class="about-content">
          <div class="logo-img-container">
            <img class="logo-img" src="assets/icon.png" alt="NexaBrowser Icon" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
            <div class="logo" style="display:none;">N</div>
          </div>
          <h1>NexaBrowser</h1>
          <div class="version-info">Version <span id="version">1.0.0</span></div>

          <div class="info-grid">
            <div class="info-item">
              <div class="info-item-label">Engine</div>
              <div class="info-item-value">Chromium (Electron)</div>
            </div>
            <div class="info-item">
              <div class="info-item-label">Platform</div>
              <div class="info-item-value">Windows 7/8/10/11</div>
            </div>
            <div class="info-item">
              <div class="info-item-label">License</div>
              <div class="info-item-value">Proprietary</div>
            </div>
            <div class="info-item">
              <div class="info-item-label">Home Page</div>
              <div class="info-item-value">
                <a href="#" id="about-home-link" class="link" onclick="openHomePage(); return false;">Home</a>
              </div>
            </div>
          </div>

          <div class="update-section">
            <button class="btn btn-primary" onclick="checkForUpdates()">Check for Updates</button>
            <div id="update-status"></div>
          </div>

          <div class="copyright">
            © <span id="year"></span> Riley Northcote. All rights reserved.<br>
            Built with ❤️ by Riley Northcote
          </div>
        </div>
      </div>
    </div>
    </div>
  </div>

  <script>
    const { ipcRenderer, shell } = require('electron');

    // Set current year
    document.getElementById('year').textContent = new Date().getFullYear();

    // Sidebar navigation
    document.querySelectorAll('.sidebar-item').forEach(item => {
      item.addEventListener('click', () => {
        const section = item.dataset.section;
        
        // Update active states
        document.querySelectorAll('.sidebar-item').forEach(i => i.classList.remove('active'));
        item.classList.add('active');
        
        document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
        document.getElementById(section).classList.add('active');
      });
    });

    // Theme handling
  const themeSelect = document.getElementById('theme-select');
  const searchEngineSelect = document.getElementById('search-engine-select');
  const homepageInput = document.getElementById('homepage-input');
  const aboutHomeLink = document.getElementById('about-home-link');
  const startupSelect = document.getElementById('startup-select');
  const saveBtn = document.getElementById('save-settings-btn');
  const saveStatus = document.getElementById('save-status');

    function getHomePageFor(engine) {
      switch ((engine || 'nexasearch').toLowerCase()) {
        case 'google':
          return 'https://www.google.com/';
        case 'bing':
          return 'https://www.bing.com/';
        case 'yahoo':
          return 'https://search.yahoo.com/';
        case 'duckduckgo':
          return 'https://duckduckgo.com/';
        case 'nexasearch':
        default:
          return 'https://northy2410.github.io/NexaSearch';
      }
    }
    
    function applyTheme(theme) {
      if (theme === 'system') {
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        document.documentElement.setAttribute('data-theme', prefersDark ? 'dark' : 'light');
      } else {
        document.documentElement.setAttribute('data-theme', theme);
      }
    }

    themeSelect.addEventListener('change', () => {
      const theme = themeSelect.value;
      applyTheme(theme);
      ipcRenderer.send('save-settings', { theme });
      ipcRenderer.send('theme-changed', theme);
    // Search engine handling
    searchEngineSelect.addEventListener('change', () => {
      const searchEngine = searchEngineSelect.value;
      const homepage = getHomePageFor(searchEngine);
      homepageInput.value = homepage;
      aboutHomeLink.textContent = new URL(homepage).hostname;
      aboutHomeLink.dataset.url = homepage;
      ipcRenderer.send('save-settings', { searchEngine });
    });
    });

    // Save Settings button
    saveBtn.addEventListener('click', () => {
      const theme = themeSelect.value;
      const searchEngine = searchEngineSelect.value;
      const startup = startupSelect.value;
      ipcRenderer.send('save-settings', { theme, searchEngine, startup });
      ipcRenderer.send('theme-changed', theme);
      saveStatus.textContent = 'Saved';
      setTimeout(() => { saveStatus.textContent = ''; }, 2000);
    });

    // Load settings
    ipcRenderer.on('settings-loaded', (event, settings) => {
      if (settings.theme) {
        themeSelect.value = settings.theme;
        applyTheme(settings.theme);
      }
      const engine = (settings && settings.searchEngine) ? settings.searchEngine : 'nexasearch';
      searchEngineSelect.value = engine;
      const homepage = getHomePageFor(engine);
      homepageInput.value = homepage;
      aboutHomeLink.textContent = new URL(homepage).hostname;
      aboutHomeLink.dataset.url = homepage;
      if (settings && settings.startup) {
        startupSelect.value = settings.startup;
      }
    });

    // Initialize theme
    ipcRenderer.send('load-settings');

    // Open home page
    function openHomePage() {
      const url = aboutHomeLink && aboutHomeLink.dataset && aboutHomeLink.dataset.url ? aboutHomeLink.dataset.url : 'https://northy2410.github.io/NexaSearch';
      shell.openExternal(url);
    }

    // Update checker
    async function checkForUpdates() {
      const statusDiv = document.getElementById('update-status');
      statusDiv.className = 'update-status checking';
      statusDiv.textContent = 'Checking for updates...';

      try {
        const result = await ipcRenderer.invoke('check-updates');
        
        if (result.error) {
          statusDiv.className = 'update-status error';
          statusDiv.textContent = `Error: ${result.error}`;
        } else if (result.updateAvailable) {
          statusDiv.className = 'update-status available';
          statusDiv.innerHTML = `
            Update available: <strong>${result.latestVersion}</strong><br>
            <a href="#" class="link" onclick="openDownloadPage(); return false;">Download Now</a>
          `;
          window.downloadUrl = result.downloadUrl;
        } else {
          statusDiv.className = 'update-status current';
          statusDiv.textContent = `You're up to date! (${result.currentVersion})`;
        }
      } catch (error) {
        statusDiv.className = 'update-status error';
        statusDiv.textContent = `Error checking for updates: ${error.message}`;
      }
    }

    function openDownloadPage() {
      if (window.downloadUrl) {
        shell.openExternal(window.downloadUrl);
      }
    }

    // Listen for system theme changes
    if (window.matchMedia) {
      window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => {
        if (themeSelect.value === 'system') {
          applyTheme('system');
        }
      });
    }
  </script>
</body>
</html>
